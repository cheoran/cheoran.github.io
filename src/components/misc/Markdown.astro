---
import "@fontsource-variable/jetbrains-mono";
import "@fontsource-variable/jetbrains-mono/wght-italic.css";

interface Props {
	class: string;
}
const className = Astro.props.class;
---
<div data-pagefind-body class={`prose dark:prose-invert prose-base !max-w-none custom-md ${className}`}>
    <!--<div class="prose dark:prose-invert max-w-none custom-md">-->
    <!--<div class="max-w-none custom-md">-->
    <slot/>
</div>

<script>
function copyText(text: string) {
    if (navigator.clipboard && window.isSecureContext) {
        return navigator.clipboard.writeText(text);
    }
    const textarea = document.createElement("textarea");
    textarea.value = text;
    textarea.style.position = "fixed";
    textarea.style.opacity = "0";
    document.body.appendChild(textarea);
    textarea.focus();
    textarea.select();
    try {
        document.execCommand("copy");
    } finally {
        document.body.removeChild(textarea);
    }
    return Promise.resolve();
}

document.addEventListener("click", function (e) {
    const path = typeof e.composedPath === "function" ? e.composedPath() : [];
    const target = (path[0] || e.target);
    const button = target instanceof Element ? target.closest(".copy-btn") : null;
    if (!button) return;

    const preEle = button.closest("pre");
    const codeEle = preEle?.querySelector("code");
    const code = Array.from(codeEle?.querySelectorAll(".code:not(summary *)") ?? [])
        .map(el => el.textContent)
        .map(t => t === "\n" ? "" : t)
        .join("\n");

    copyText(code);

    const timeoutId = button.getAttribute("data-timeout-id");
    if (timeoutId) {
        clearTimeout(parseInt(timeoutId, 10));
    }

    button.classList.add("success");
    const newTimeoutId = setTimeout(() => {
        button.classList.remove("success");
    }, 1000);
    button.setAttribute("data-timeout-id", newTimeoutId.toString());
});
</script>
